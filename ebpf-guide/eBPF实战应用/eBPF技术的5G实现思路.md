# eBPF技术的5G实现思路

在讨论利用eBPF程序的具体好处和方法时，很容易直接进入技术兔子洞。该技术非常详细，可用于各种用例。因此，谈话可能会很快围绕细节展开，同时掩盖技术的基本要素。与任何较新的技术一样，设置水平并退后一步讨论基础知识通常很有帮助。这篇文章将用于实现这一目标——提供对eBPF程序基础知识的高级视图，更具体地说，是用于 5G SA 可见性的eBPF程序。

*eBPF**是关于内核的*

![img](https://996station.com/wp-content/uploads/2022/11/20221126085232293.png?imageView2/0/format/webp/q/75)

[正如我们在之前的博文中所讨论的那样，](https://www.mantisnet.com/blog/ebpf-v-sidecar-containers-5g-observability) eBPF是一种通过在系统内核级别部署来绑定操作系统原语的方法。

右图显示了一个用于监控 5G 资源的示例eBPF程序。请注意，eBPF程序/代理的“插入点”在节点级别，而不是 pod/容器级别（因为其他基于代理的方法，例如 sidecar 容器，依赖于n）。

eBPF解决方案作为存在于内核空间中的沙盒程序运行，它们不需要对内核进行任何更改。这不是内核模块，而是在用户空间中定义的独立实体，可以将容器环境内省为在内核空间中运行的独立程序。eBPF程序可以通过部署为单个 pod/容器来自省整个节点环境（所有 pod 到 pod 的通信、进程、接口等）。它对内核检测的独特关注是 eBPF 将自己与其他云原生技术区分开来的一种方式。 

eBPF 是关于消息的

![img](https://996station.com/wp-content/uploads/2022/11/20221126085239747.png?imageView2/0/format/webp/q/75)

eBPF程序非常高效。与 sidecar 容器（和vTAP 、span 端口、服务网格等）不同， eBPF程序在内核级别充当事件处理程序——它们不会搅动环境中的每条信息，而是为非常特定的类型设置挂钩交通。 

**在监控程序的上下文中，可以将其视为关注消息与关注数据包**之间的区别。eBPF程序*可以瞄准并观察*基于 HTTP/2 的环境的核心消息传递。eBPF程序为其正在寻找的特定消息/事件（例如，特定于 5G 的 SBI 消息传递）设置挂钩，并在这些特定挂钩上触发以开始监视通信。



这种方法与前面提到的方法（vTAPS 、sidecars 等）有很大的不同，后者是非常大量的数据包进程，通常处理环境中的所有数据（而不是为非常具体的消息设置挂钩）。这些传统方法需要计算资源来访问和处理所有这些数据包数据，从而导致生产计算资源承受巨大压力。另一方面， eBPF允许使用一种基本方法，该方法基于以下因素将**资源利用率降低一个数量级**

： - 它关注消息，而不是数据包
\- 它如何访问数据的目标性质

*eBPF**占用空间小*

将监控解决方案部署到分布式 k8s环境时，最大的考虑因素之一是解决方案本身的实际占用空间。使用eBPF程序，代理被部署为daemonsets ，并与生产资源一起自动扩展。这意味着每个节点将有一 (1) 个代理（无论节点是裸机还是基于 VM 都无关紧要）。这些代理可以查看该节点中存在的 pod 和容器内部和之间的所有活动。请看下面的例子，每个节点有 10 个 pod：

![img](https://996station.com/wp-content/uploads/2022/11/20221126085245187.png?imageView2/0/format/webp/q/75)

与替代方法相比，这种方法显着减少了足迹。eBPF 程序的“部署足迹”远小于边车容器方法。如果使用 sidecar 容器，则必须在上面的示例中部署六十 (60) 个代理，而基于 eBPF 的方法只需要六 (6) 个代理。 

*eBPF 与供应商无关*

同样，eBPF程序通过在**节点级别**（linux内核）集成到 k8s 集群来访问数据。eBPF程序不访问容器或 pod 级别的信息。

![img](https://996station.com/wp-content/uploads/2022/11/20221126085251177.png?imageView2/0/format/webp/q/75)

 这导致一个解决方案只需要来自生产系统的一个集成依赖——内核支持 eBPF。实际上，这意味着正在运行的linux内核版本需要是大约在过去 13 年发布的版本（当时eBPF最初 被采用并包含在linux基金会中）。对应用程序层的依赖性为零——这意味着不存在 基于生产环境中存在的供应商的集成依赖性。

这在整个云原生环境中非常有益，但在 5G 电信云原生环境中尤其如此，随着时间的推移，服务提供商的趋势是从单一供应商、整体解决方案转向最佳网络功能选择现在有多个供应商出现在 5G 堆栈的各个方面。 



## 作者

Mike Fecher

## 原文链接

https://www.mantisnet.com/blog/back-to-the-basics-ebpf-fundamentals